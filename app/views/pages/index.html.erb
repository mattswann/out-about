<h1>INDEX</h1>

<%= form_tag pages_path, :id => 'search', :method => 'get' do %>
  <%= text_field_tag :search_box, nil, :placeholder => "Enter a search", :required => true%>
  <button id="search-button">Search</button>
<% end %>


<div id="output">

</div>

<script type="text/template" id="result-template">

  <article>
    <h2><a href='/venues/{{ Id }}'> {{ name }} </a></h2>
    <p class="venue-info">Phone Number: {{ phone }} </p>
    <p class="venue-info"> Address: {{ address }} </p>
    <p class="venue-info"> City: {{ city }} </p>
  </article>

</script>



<script>

   _.templateSettings = {
  interpolate: /\{\{(.+?)\}\}/g
  };

var displayData = function(Id, name, phone, address, city, postcode, statecode) {
// console.log(displayData);
    var $templateFunc = _.template($('#result-template').html());
    var htmlOutput = $templateFunc( {
      name: name,
      phone: phone,
      address: address,
      city: city,
      postcode: postcode,
      statecode: statecode,
      Id: Id } );

    $('#output').append(htmlOutput);

  }

   var $form = $('#search');

    $form.on('submit', function(e) {
      e.preventDefault();

      $('#output').empty();

      var $inputVal = $('#search_box').val();

      var search = {
        url: '/pages/search_json',
        dataType: 'json',
        data: {search_box: $('#search_box').val()}
      };

      $.ajax(search).done(function(data) {
        var business = data.businesses;
        _.each(business, function(buz, index){
          var Id = buz.id;
          var name = buz.name;
          var phone = buz.phone;
          var address = buz.location.address[0];
          var city = buz.location.city;
          var postcode = buz.location.postal_code;
          var statecode = buz.location.statecode;

          displayData(Id, name, phone, address, city, postcode, statecode)

          });
        });
      });

</script>




